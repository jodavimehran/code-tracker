                                                                                    1)  package dat;
                                                                                    2)
                                                                                    3)  import benchmark.utils.CaseInfo;
                                                                                    4)  import benchmark.utils.Configuration.Configuration;
                                                                                    5)  import benchmark.utils.Configuration.ConfigurationFactory;
                                                                                    6)  import org.refactoringminer.astDiff.models.ASTDiff;
                                                                                    7)  import org.refactoringminer.astDiff.models.ProjectASTDiff;
                                                                                    8)  import org.slf4j.Logger;
                                                                                    9)  import org.slf4j.LoggerFactory;
                                                                                    10)
                                                                                    11) import java.util.ArrayList;
                                                                                    12) import java.util.List;
                                                                                    13)
                                                                                    14) import static benchmark.utils.Helpers.runWhatever;
                                                                                    15)
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 16) /* Created by pourya on 2024-01-18*/
ae3a4f8a5 src/main/java/dat/Make.java       (Pouryafard75 2024-06-24 21:47:09 -0400 17) public class MakeIntels {
ae3a4f8a5 src/main/java/dat/Make.java       (Pouryafard75 2024-06-24 21:47:09 -0400 18)     private final static Logger logger = LoggerFactory.getLogger(MakeIntels.class);
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 19)     private static final Configuration configuration = ConfigurationFactory.refOracle();
ba790bfa4 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:48 -0500 20)     private static final String destination = "intel.csv";
ba790bfa4 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:48 -0500 21)     private static int numThreads = Runtime.getRuntime().availableProcessors();
ae3a4f8a5 src/main/java/dat/Make.java       (Pouryafard75 2024-06-24 21:47:09 -0400 22)
ae3a4f8a5 src/main/java/dat/Make.java       (Pouryafard75 2024-06-24 21:47:09 -0400 23)
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 24)     public static void main(String[] args) throws Exception {
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 25)         logger.info("Start running DAT");
ba790bfa4 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:48 -0500 26)         int case_count = 0;
ae3a4f8a5 src/main/java/dat/MakeIntels.java (Pouryafard75 2024-06-24 21:47:09 -0400 27)         IntelDao intelDao = new IntelDao();
ba790bfa4 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:48 -0500 28)         List<Intel> intels = new ArrayList<>();
ba790bfa4 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:48 -0500 29)         try {
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 30)             for (CaseInfo info : configuration.getAllCases()) {
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 31)                 case_count++;
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 32)                 ProjectASTDiff projectASTDiff = runWhatever(info.getRepo(), info.getCommit());
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 33)                 for (ASTDiff rm_astDiff : projectASTDiff.getDiffSet()) {
ba790bfa4 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:48 -0500 34) //                    logger.info("Working on " + info.makeURL() + " " + rm_astDiff.getSrcPath());
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 35)                     logger.info("Case " + case_count + "/" + configuration.getAllCases().size());
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 36)                     GridSearch dat = new GridSearch(info, projectASTDiff, rm_astDiff, configuration);
ba790bfa4 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:48 -0500 37)                     intels.addAll(dat.run(numThreads));
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 38)                 }
ae3a4f8a5 src/main/java/dat/MakeIntels.java (Pouryafard75 2024-06-24 21:47:09 -0400 39)                 intelDao.insertIntels(intels);
5b33dc6f8 src/main/java/dat/MakeIntels.java (Pouryafard75 2024-06-25 01:09:18 -0400 40)                 // if (case_count == 2) break;
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 41)
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 42) }
ba790bfa4 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:48 -0500 43)         }
ba790bfa4 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:48 -0500 44)         catch (Exception e) {
ba790bfa4 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:48 -0500 45)             logger.error("Error in DAT", e);
ba790bfa4 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:48 -0500 46)             logger.debug("Error in DAT", e);
ba790bfa4 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:48 -0500 47)             throw new RuntimeException(e);
ba790bfa4 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:48 -0500 48)         }
ae3a4f8a5 src/main/java/dat/MakeIntels.java (Pouryafard75 2024-06-24 21:47:09 -0400 49)         finally {
ae3a4f8a5 src/main/java/dat/MakeIntels.java (Pouryafard75 2024-06-24 21:47:09 -0400 50)             HibernateUtil.shutdown();
ae3a4f8a5 src/main/java/dat/MakeIntels.java (Pouryafard75 2024-06-24 21:47:09 -0400 51)         }
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 52)         logger.info("DAT finished");
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 53)
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 54)     }
e5e209d52 src/main/java/dat/Make.java       (Pouryafard75 2024-03-06 20:33:47 -0500 55) }
                                                                                    56)
